/*!
 * ZUI: 标签页管理器 - v1.7.0 - 2017-12-26
 * http://zui.sexy
 * GitHub: https://github.com/easysoft/zui.git 
 * Copyright (c) 2017 cnezsoft.com; Licensed MIT
 */
!function(t){"use strict";var a=function(a){var e=this;"string"==typeof a?e.url=a:t.isPlainObject(a)&&t.extend(e,a),e.id||(e.id=t.zui.uuid()),e.type||(e.iframe?(e.type="iframe",e.url=e.iframe):e.ajax?(e.type="ajax",e.url=t.isPlainObject(e.ajax)?e.ajax.url:e.ajax):e.custom?e.type="custom":e.type="iframe"),e.createTime=(new Date).getTime(),e.openTime=0,e.onCreate&&e.onCreate.call(e)};a.prototype.open=function(){var t=this;t.openTime=(new Date).getTime(),t.onOpen&&t.onOpen.call(t)},a.prototype.close=function(){var t=this;t.openTime=0,t.onClose&&t.onClose.call(t)},a.create=function(t){return t instanceof a?t:new a(t)};var e="zui.tabs",n={zh_cn:{close:"关闭",errorCannotFetchFromRemote:"无法从远程服务器（{0}）获取内容。"}},i=function(o,s){var r=this;r.name=e,r.$=t(o),s=r.options=t.extend({},i.DEFAULTS,this.$.data(),s);var l=s.lang||"zh_cn";r.lang=t.isPlainObject(l)?t.extend(!0,{},n[l.lang||t.zui.clientLang()],l):n[l];var c=r.$.find(".tabs-navbar");c.length||(c=t('<nav class="tabs-navbar"></nav>').appendTo(r.$)),r.$navbar=c;var d=c.find(".tabs-nav");d.length||(d=t('<ul class="tabs-nav"></ul>').appendTo(c)),r.$nav=d;var v=r.$.find(".tabs-container");v.length||(v=t('<div class="tabs-container"></div>').appendTo(r.$)),r.$tabs=v,r.activeTabId=s.defaultTab;var p=s.tabs||[];r.tabs={},t.each(p,function(t,e){var n=a.create(e);r.tabs[n.id]=n,r.activeTabId||(r.activeTabId=n.id),r.renderTab(n)}),r.closedTabs=[],r.open(r.getActiveTab()),d.on("click."+e,".tab-nav-link",function(){r.open(r.getTab(t(this).data("id")))}).on("click."+e,".tab-nav-close",function(a){r.close(t(this).closest(".tab-nav-item").data("id")),a.stopPropagation()})};i.prototype.adjustNavs=function(t){var a=this;if(!t)return a.adjustNavsTimer&&clearTimeout(a.adjustNavsTimer),void(a.adjustNavsTimer=setTimeout(function(){a.adjustNavs(!0)},50));a.adjustNavsTimer&&(a.adjustNavsTimer=null);var e=a.$nav,n=e.find(".tab-nav-item:not(.hidden)"),i=e.width(),o=n.length,s=Math.floor(i/o);s<96&&(s=Math.floor((i-96)/(o-1))),e.toggleClass("tab-nav-condensed",s<=50),n.css("max-width",s)},i.prototype.renderTab=function(a,e){var n=this,i=(n.$nav,t("#tab-nav-item-"+a.id));if(!i.length){var o=t('<a class="tab-nav-link"><i class="icon"></i><span class="text"></span><i class="close tab-nav-close" title="'+n.lang.close+'"></i></a>').attr({href:"#tabs-item-"+a.id,id:a.id});if(i=t('<li class="tab-nav-item" id="tab-nav-item-'+a.id+'" />').append(o).appendTo(n.$nav),e){var s=t("#tab-nav-item-"+e);s.length&&i.insertAfter(s)}n.adjustNavs()}var o=i.find("a").attr("title",a.desc);return o.find(".icon").attr("class","icon "+(a.icon||n.options.defaultTabIcon)),o.find(".text").text(a.title||""),i},i.prototype.getActiveTab=function(){var t=this;return t.activeTabId?t.tabs[t.activeTabId]:null},i.prototype.getTab=function(t){var a=this;return t?("object"==typeof t&&(t=t.id),a.tabs[t]):a.getActiveTab()},i.prototype.close=function(a){var e=this,n=e.getTab(a);n&&(t("#tab-nav-item-"+n.id).remove(),t("#tab-"+n.id).remove(),n.close(),delete e.tabs[n.id],e.closedTabs.push(n),e.$.callComEvent(e,"onClose",n));var i;t.each(e.tabs,function(t,a){(!i||i.openTime<a.openTime)&&(i=a)}),i&&e.open(i)},i.prototype.open=function(a){var e=this,n=e.render(a);e.$nav.find(".tab-nav-item.active").removeClass("active"),n.addClass("active");var i=t("#tab-"+a.id);i.length||(i=t('<div class="tab-pane" id="tab-'+a.id+'" />').appendTo(e.$tabs)),e.$tabs.find(".tab-pane.active").removeClass("active"),i.addClass("active"),a.open(),a.loaded||e.reload(a),e.$.callComEvent(e,"onOpen",a)},i.prototype.showMessage=function(a,e){t.zui.messager.show(a,t.extend({placement:"center"},that.options.messagerOptions,{type:e}))},i.prototype.reload=function(a){var e=this,n=t("#tab-nav-item-"+a.id).addClass("loading").removeClass("has-error"),i=t("#tab-"+a.id).addClass("loading").removeClass("has-error"),o=function(t,o){a.openTime&&(n.removeClass("loading"),i.removeClass("loading"),e.$.callComEvent(e,"onRefresh",a),"string"==typeof t&&i.html(t),o&&(n.addClass("has-error"),i.addClass("has-error"),e.showMessage(o,"danger")),tan.loaded=(new Date).getTime())};if("ajax"===a.type){var s={type:"get",url:a.url,error:function(t,n,i){o(!1,e.lang.errorCannotFetchFromRemote.format(a.url))},success:function(t){o(t)}};t.isPlainObject(a.ajax)&&(s=t.extend(s,a.ajax)),t.ajax(s)}else if("iframe"===a.type)try{var r="tab-iframe-"+a.id,l=t('<iframe id="'+r+'" name="'+r+'" src="'+a.url+'" frameborder="no"  allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"  allowtransparency="true" scrolling="auto" style="width: 100%; height: 100%; left: 0px;"></iframe>');l.appendTo(i);var c=document.getElementById(r);c.onload=c.onreadystatechange=function(){this.readyState&&"complete"!=this.readyState||o()}}catch(d){o()}else{var v=a.content||a.custom;"function"==typeof v?(v=v(a,o,e),v!==!0&&o(v)):o(v)}},i.prototype.closeOthers=function(a){$nav.find(".tab-nav-item:not(.hidden)").each(function(){var e=t(this).data("id");e!==a&&that.close(a)})},i.prototype.closeRight=function(a){for(var e=t("#tab-nav-item-"+a),n=e.next(".tab-nav-item:not(.hidden)");n.length;)that.close(n.data("id")),n=e.next(".tab-nav-item:not(.hidden)")},i.prototype.closeAll=function(){$nav.find(".tab-nav-item:not(.hidden)").each(function(){that.close(t(this).data("id"))})},i.prototype.reopen=function(){that.closedTabs.length&&that.open(that.closedTabs.pop())},t.fn.tabs=function(a){return this.each(function(){var n=t(this),o=n.data(e),s="object"==typeof a&&a;o||n.data(e,o=new i(this,s)),"string"==typeof a&&o[a]()})},i.NAME=e,t.fn.tabs.Constructor=i}(jQuery);