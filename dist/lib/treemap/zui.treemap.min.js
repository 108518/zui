/*!
 * ZUI: 树形图 - v1.7.0 - 2017-06-17
 * http://zui.sexy
 * GitHub: https://github.com/easysoft/zui.git 
 * Copyright (c) 2017 cnezsoft.com; Licensed MIT
 */
!function(e,t,a,o,r){"use strict";var n="zui.treemap",l={data:[],cableWidth:1,cableColor:"#808080",cableStyle:"solid",rowSpace:30,nodeSpace:20,listenNodeResize:!0,nodeTemplate:'<div class="treemap-node"><a class="treemap-node-wrapper"></a></div>',foldable:!0,clickNodeToFold:!0},d=function(t){return t.children("li,.treemap-data-item").map(function(){var t=e(this),a=t.data(),o=t.children(".text"),r=t.children(".content"),n=t.children("ul,.treemap-data-list");if(o.length&&(a.text=o.text()),r.length&&(a.html=r.html()),n.length&&(a.children=d(n)),!a.text&&!a.html){var l=t.children(":not(ul,.treemap-data-list)"),i=t.clone();i.find("ul,.treemap-data-list").remove(),l.length?a.html=i.html():a.text=i.text()}return a.id||(a.id=e.zui.uuid()),a}).get()},i=function(t,a){var o=e(t);e.isArray(a)&&(a={data:a}),a=e.extend({},l,o.data(),a);var r=a.data||[];if(!r.length){var n=o.children(".treemap-data");n.length&&(r=d(n.hide()))}var i=o.children(".treemap-nodes");i.length||(i=e('<div class="treemap-nodes" unselectable="on"/>').appendTo(o));var s=this;s.$=o,s.$nodes=i,s.data=e.isArray(r)?r:[r],s.options=a,s.offsetX=0,s.offsetY=0,s.scale=a.scale||1,s.render(),i.on("resize",".treemap-node-wrapper",function(){s.delayDrawLines()}),a.foldable&&i.on("click",a.clickNodeToFold?".treemap-node-wrapper":".treemap-node-fold-icon",function(){var t=e(this).closest(".treemap-node").addClass("tree-node-collapsing");t.toggleClass("collapsed").find('[data-toggle="tooltip"]').tooltip("hide"),s.drawLines(),setTimeout(function(){t.removeClass("tree-node-collapsing")},200)}),i.on("click",".treemap-node-wrapper",function(){var t=e(this).closest(".treemap-node");s.callEvent("onNodeClick",t.data("node"))})};i.prototype.render=function(e){var t=this;t.data=e||t.data,t.data&&(t.createNodes(),t.drawLines()),t.callEvent("afterRender")},i.prototype.createNodes=function(t,a,o){var r=this,l=r.options,d=l.rowSpace,i=r.$nodes;a||(i.find(".treemap-node-wrapper").off("resize."+n),i.empty()),l.sort&&t.sort(e.isFunction(l.sort)?l.sort:function(e,t){return(e.order||0)-t.order});var s=null;t=t||r.data,e.each(t||r.data,function(p,c){"string"==typeof c&&(c={html:c},t[p]=c);var h=e.isFunction(l.nodeTemplate)?l.nodeTemplate(c,r):e(l.nodeTemplate),f=h.find(".treemap-node-wrapper");f.length||(f=e('<div class="treemap-node-wrapper"/>').appendTo(h));var m=c.children,u=m&&m.length;c.isOnlyOneChild=1===u,c.idx=p;var g=a?a.row+1:0;h.toggleClass("treemap-node-has-child",!!u).toggleClass("treemap-node-has-parent",!!a).toggleClass("treemap-node-one-child",1===u).toggleClass("collapsed",!!c.collapsed&&"false"!==c.collapsed).toggleClass("treemap-node-root",!g).attr("data-id",c.id).data("node",c),c.className&&h.addClass(c.className),c.row=g;var v=e.extend({},l.nodeStyle,c.style);c.textColor&&(v.color=c.textColor),c.color&&(v.backgroundColor=c.color),c.border&&(v.border=c.border);var w=e.extend({},c.attrs,{title:c.caption});if(c.tooltip&&(w["data-toggle"]="tooltip",w.title=c.tooltip),f.attr(w).css(v),s&&h.css("padding-left",l.nodeSpace),c.html?f.append(c.html):c.text&&f.text(c.text),h.appendTo(a?a.$children:i),c.bounds={width:f.outerWidth(),height:f.outerHeight()},s&&(s.next=c),c.prev=s,c.parent=a,c.$=h,c.$wrapper=f,u){var b=h.find(".treemap-node-children");b.length||(b=e('<div class="treemap-node-children"/>').appendTo(h)),b.css("margin-top",d),c.$children=b,r.createNodes(m,c)}l.listenNodeResize&&f.on("resize."+n,function(){c.bounds.width=f.outerWidth(),c.bounds.height=f.outerHeight(),r.delayDrawLines()}),s=c,o&&o(h,c)}),a||i.find('[data-toggle="tooltip"]').tooltip(l.tooltip)},i.prototype.delayDrawLines=function(){var e=this;clearTimeout(e.delayDrawLinesTask),e.delayDrawLinesTask=setTimeout(function(){e.drawLines()},10)},i.prototype.drawLines=function(t,a){var r=this,n=r.options,l=n.rowSpace,d={};n.cableWidth&&(d.borderWidth=n.cableWidth),n.cableStyle&&(d.borderStyle=n.cableStyle),n.cableColor&&(d.borderColor=n.cableColor);var i=o.round(l/2),s=r.$nodes.offset().left;e.each(t||r.data,function(t,p){var c=p.$wrapper,h=p.children,f=e.extend({height:i,top:-i-1,left:o.round((c.outerWidth()-d.borderWidth)/2)},d);if(a&&!a.isOnlyOneChild){var m=c.find(".treemap-line-top");m.length||(m=e('<div class="treemap-line-top"/>').appendTo(c)),m.css(f)}if(h&&h.length){f.top=c.outerHeight()-1,p.isOnlyOneChild&&(f.height=l);var u=c.find(".treemap-line-bottom");if(u.length||(u=e('<div class="treemap-line-bottom"/>').appendTo(c),n.foldable&&u.append('<i class="treemap-node-fold-icon icon" style="transform: translate(-'+o.floor(f.borderWidth/2)+"px, "+i+'px)"/>')),u.css(f),r.drawLines(h,p),h.length>1){var g=h[0],v=h[h.length-1],w=p.$.children(".treemap-line");w.length||(w=e('<div class="treemap-line"/>').insertAfter(c));var b=o.round(g.$wrapper.offset().left-s+g.bounds.width/2);w.css(e.extend({marginTop:i,left:b,width:v.$wrapper.offset().left-s-b+v.bounds.width/2},d))}}}),a||r.callEvent("afterDrawLines")},i.prototype.callEvent=function(t,a){var o=this;if(e.isArray(a)||(a=[a]),o.$.trigger(t,a),e.isFunction(o.options[t]))return o.options[t].apply(o,a)},i.DEFAULTS=l,i.NAME=n,e.fn.treemap=function(t,a){return this.each(function(){var o=e(this),r=o.data(n),l="object"==typeof t&&t;r||o.data(n,r=new i(this,l)),"string"==typeof t&&r[t](a)})},e.fn.treemap.Constructor=i}(jQuery,window,document,Math,void 0);