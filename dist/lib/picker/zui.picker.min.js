/*!
 * ZUI: 选择器 - v1.9.1 - 2020-05-11
 * http://openzui.com
 * GitHub: https://github.com/easysoft/zui.git 
 * Copyright (c) 2020 cnezsoft.com; Licensed MIT
 */
!function(e,t,i){"use strict";var o="zui.picker",n={},r={lang:null,remote:null,remoteConverter:null,remoteOnly:!1,onRemoteError:null,textKey:"text",valueKey:"value",keysKey:"keys",multi:"auto",formItem:"auto",list:null,allowSingleDeselect:null,showMultiSelectedOptions:!1,autoSelectFirst:!1,optionItemFormatter:null,maxSelectedCount:0,maxListCount:50,hideEmptyTextOption:!0,searchValueKey:!0,emptyResultHint:null,hideOnWindowScroll:!0,inheritFormItemClasses:!1,emptySearchResultHint:null,accurateSearchHint:null,remoteErrorHint:null,deleteByBackspace:!0,disableScrollOnShow:!0,maxDropHeight:250,dropDirection:"auto",dropWidth:"100%",maxAutoDropWidth:450,multiValueSplitter:",",searchDelay:200,fixLabelFor:!0,hotkey:!0,onSelect:null,onDeselect:null,beforeChange:null,onChange:null,onReady:null,onNoResults:null,onShowingDrop:null,onHidingDrop:null,onShowedDrop:null,onHiddenDrop:null},l={zh_cn:{emptyResultHint:"没有可选项",emptySearchResultHint:"没有找到 “{0}”",accurateSearchHint:"请提供更多关键词缩小匹配范围",remoteErrorHint:"无法从服务器获取结果 - {0}"},zh_tw:{emptyResultHint:"沒有可選項",emptySearchResultHint:"沒有找到 “{0}”",accurateSearchHint:"請提供更多關鍵詞縮小匹配範圍",remoteErrorHint:"無法從服務器獲取結果 - {0}"},en:{emptyResultHint:"No options",emptySearchResultHint:'Cannot found "{0}"',accurateSearchHint:"Suggest to provide more keywords",remoteErrorHint:"Unable to get result from server: {0}"}},s=function(t,i){var n=this;n.name=o,n.id="pk_"+e.zui.uuid(),n.$=e(t),i=n.options=e.extend({},s.DEFAULTS,this.$.data(),i);var r=e.zui.clientLang?e.zui.clientLang():"en",a=i.lang||r;n.lang=e.zui.getLangData?e.zui.getLangData(o,a,l):l[a]||l[r];var p,c,u=i.formItem,d='.form-item,input[type="hidden"],select,input[type="text"]';if(p="self"===u?n.$:"auto"!==u&&u?n.$.find(u):n.$.is(d)?n.$:n.$.find(d).first(),!p.length)return console.error&&console.error("Cannot found form item for picker.");if(p.is('input[type="hidden"]'))c="hidden";else if(p.is("select"))c="select";else{if(!p.is('input[type="text"]'))return console.error&&console.error("Unknown form type for picker.");c="text"}i.inheritFormItemClasses&&f.addClass(p.attr("class")),n.formType=c,n.$formItem=p.removeClass("picker").hide(),n.selfFormItem=p.is(n.$);var h=i.multi;h&&"auto"!==h||(h="select"===c&&"multiple"===p.attr("multiple")),h=!!h,n.multi=h;var v=i.list;v?n.setList("function"==typeof v?v({search:n.search,limit:i.maxListCount}):v,!0):"select"===c?n.updateFromSelect():n.setList([],!0);var f;f=!n.selfFormItem&&n.$.hasClass("picker")?n.$:e('<div class="picker" />').insertAfter(n.$),f.addClass("picker").toggleClass("picker-multi",h).toggleClass("picker-single",!h);var g=f.children(".picker-selections");g.length?g.empty():g=e('<div class="picker-selections" />');var m=n.id+"-search",y=e('<input id="'+m+'" type="text" class="picker-search">').appendTo(g);if(!h){var k=e('<div class="picker-selection picker-selection-single"><span class="picker-selection-text"></span></div>');i.allowSingleDeselect&&k.append('<span class="picker-selection-remove"></span>'),k.appendTo(g),n.$singleSelection=k}f.toggleClass("picker-input-empty",!y.val().length).append(g),n.$container=f,n.$selections=g,n.$search=y,n.search="";var S=i.placeholder;if(void 0===S&&(S=p.attr("placeholder")),"string"==typeof S&&S.length&&g.append(e('<div class="picker-placeholder" />').text(S)),i.placeholder=S,i.fixLabelFor){var x=p.attr("id");x&&e('label[for="'+x+'"]').attr("for",m)}var w=void 0!==i.defaultValue?i.defaultValue:p.val();n.setValue(w,!0),y.on("focus",function(){f.addClass("picker-focus"),n.showDropList()}).on("blur",function(){f.removeClass("picker-focus")}).on("input change",function(){var e=y.val();h&&y.width(14*e.length),f.toggleClass("picker-input-empty",!e.length),n.tryUpdateList(e)}),i.hotkey&&y.on("keydown",function(e){var t=e.key||e.which;if(n.dropListShowed){var o=n.activeValue,r="string"==typeof o;if("Enter"===t||13===t)r&&(n.select(o),n.multi||y.blur(),e.preventDefault());else if("ArrowDown"===t||40===t){var l,s=n.$activeOption;if(s&&(l=s.next(".picker-option"),n.multi))for(;l.length&&l.hasClass("picker-option-selected");)l=l.next(".picker-option");l&&l.length||(l=n.$optionsList.children(n.multi?".picker-option:not(.picker-option-selected)":".picker-option").first()),l.length&&n.activeOption(l),e.preventDefault()}else if("ArrowUp"===t||30===t){var a,s=n.$activeOption;if(s&&(a=s.prev(".picker-option"),n.multi))for(;a.length&&a.hasClass("picker-option-selected");)a=a.prev(".picker-option");a&&a.length||(a=n.$optionsList.children(n.multi?".picker-option:not(.picker-option-selected)":".picker-option").last()),a.length&&n.activeOption(a),e.preventDefault()}else i.deleteByBackspace&&n.multi&&("Backspace"===t||8===t)&&n.value&&n.value.length&&n.deselect(n.value[n.value.length-1])}}),h&&g.on("mousedown",function(e){if(n.dropListShowed)return e.preventDefault(),void e.stopPropagation()}).on("mouseup",function(t){e(t.target).closest(".picker-selection-remove").length||n.dropListShowed||n.focus()}),g.on("click",".picker-selection-remove",function(t){if(n.multi){var i=e(this).closest(".picker-selection");n.deselect(i.data("value"))}else n.deselect();t.stopPropagation()}),p.on("chosen:updated",function(){n.updateFromSelect(),n.setValue(p.val()),n.updateList()}).on("chosen:activate",n.focus).on("chosen:open",n.showDropList).on("chosen:close",n.hideDropList),f.addClass("picker-ready"),setTimeout(function(){n.triggerEvent("ready",{picker:n},"","chosen:ready")},0)};s.prototype.focus=function(){this.$search.focus()},s.prototype.select=function(e){var t=this;if(!t.isSelectedValue(e)){if(t.triggerEvent("select",{value:e,picker:t})===!1)return;if(t.multi){var i=t.value;i||(i=[]),i.push(e),t.setValue(i)}else t.setValue(e)}t.hideDropList()},s.prototype.deselect=function(e){var t=this;if(t.multi){if(!t.isSelectedValue(e))return;if(t.triggerEvent("deselect",{value:e,picker:t})===!1)return;var i=t.value;if(i&&i.length)for(var o=0;o<i.length;++o)if(i[o]===e){i.splice(o,1),t.setValue(i);break}}else t.setValue("")},s.prototype.updateMessage=function(e,t,i){var o=this,n=o.$message,r="string"==typeof e&&e.length;e=r?e:"",o.hasMessage=r,n.attr("title",e).text(e).attr("data-type",t),o.$dropMenu.toggleClass("picker-has-message",!!r),i||"top"!==o.dropDirection||o.layoutDropList()},s.prototype.getRemoteList=function(t,i){var o=this,n=o.options.remote;if(n){var r,l=o.options,s={search:o.search,limit:l.maxListCount};if(r="string"==typeof n?{url:n}:"function"==typeof n?n(s,o):n,!r.url)return void console.warn("Remote url must provide to get remote list in picker.");r.url=r.url.format(s),o.updateMessage(""),o.$container.addClass("picker-loading"),o.remoteXhr&&o.remoteXhr.abort(),o.remoteXhr=e.ajax(e.extend({dataType:"json",dataFilter:l.remoteConverter,data:s},r)).done(function(i,n,r){var s=!1;if(i){if(e.isPlainObject(i))if("success"!==i.result&&"ok"!==i.result||!e.isArray(i.data))if("fail"===i.result)o.updateMessage(i.message||JSON.stringify(i),"danger");else{var a=[];e.each(i,function(t,i){var o={};o[l.valueKey]=t,"object"==typeof i?e.extend(o,i):o[l.textKey]=i,a.push(o)}),i=a}else i=i.data;e.isArray(i)&&(s=i.length,o.setList(i,l.remoteOnly))}t&&t(s)}).fail(function(e,t){var n,r=l.onRemoteError;n="function"==typeof r?r(e,t):"string"==typeof r?r:(l.remoteErrorHint||o.lang.remoteErrorHint).format(t||""),o.updateMessage(n,"danger"),i&&i()}).always(function(){o.remoteXhr=null,o.$container.removeClass("picker-loading")})}},s.prototype.layoutDropList=function(i,o,n){var r=this;if(r.$dropMenu){var l=r.options,s=l.maxDropHeight||Number.MAX_VALUE,a=r.$dropMenu,p=r.$optionsList;i||a.css({opacity:0,width:"auto","max-width":"none"}),p.css({"max-height":s}),setTimeout(function(){var i=r.$selections[0].getBoundingClientRect(),c=o?l.dropDirection:r.dropDirection||l.dropDirection;"function"==typeof c&&(c=c(i,r));var u=l.maxAutoDropWidth,d=e(t),h=d.height(),v=a.height(),f=l.dropWidth||"auto",g={left:i.left,opacity:1};"auto"===c&&(c=i.top+i.height+v>h&&i.top>h-i.top-i.height?"top":"bottom"),r.dropDirection=c;var m=Math.min(s,"bottom"===c?h-i.top-i.height:i.top);if(v=Math.min(v,m),g.top="bottom"===c?i.top+i.height:i.top-v,"100%"===f)g.width=i.width;else if("auto"===f){if(g.width="auto",g.maxWidth="auto"===u?i.width:u,r.multi){var y=r.$search[0].getBoundingClientRect();g.left=y.left}}else g.width=f;var k=r.hasMessage?r.$message.outerHeight():0;p.css("max-height",v-k),a.css(g),n&&n()},0)}},s.prototype.tryUpdateList=function(e){var t=this;t.search!==e&&(t.search=e,t.updateListTimer&&clearTimeout(t.updateListTimer),t.updateListTimer=setTimeout(function(){t.updateListTimer=null,t.updateList()},t.options.searchDelay))},s.prototype.renderOptionsList=function(t,i){var o=this,n=o.$optionsList;if(void 0===t?t=o.optionsList:o.optionsList=t,n){var r="",l=o.options,s=o.search,a="string"==typeof s&&s.length;if(t.length){for(var p,c,u,d=l.maxListCount,h=l.valueKey,v=l.textKey,f=l.showMultiSelectedOptions,g=Math.min(t.length,d),m=s.toLowerCase(),y=n.children(".picker-option").addClass("picker-expired"),k=o.activeValue,S=void 0!==k&&null!==k,x=0;x<g;++x){var w=t[x],L=w[h],C=o.isSelectedValue(L);if(f||!C||!o.multi){var $=w[v];if(L.length&&(!l.hideEmptyTextOption||$.length)){var b=o.getItemID(w,"option"),D=y.find("#"+b);D.length?D.removeClass("picker-expired"):D=e('<a class="picker-option" id="'+b+'" data-value="'+L+'"><span class="picker-option-text"></span><span class="picker-option-keys"></span></a>'),D.attr("title",$).removeClass(".picker-option-active").toggleClass("picker-option-selected",C);var _=D.find(".picker-option-text");if(a){var O=$.toLowerCase(),M=O.split(m);if(M.length>1){_.empty();var E=0,H=M[0].length;H&&(_.append(e("<span>").text($.substr(E,H))),E+=H);for(var V=1;V<M.length;++V)_.append(e('<span class="picker-option-text-matched">').text($.substr(E,s.length))),E+=s.length,H=M[V].length,H&&(_.append(e("<span>").text($.substr(E,H))),E+=H)}else _.text($)}else _.text($);D.appendTo(n),o.multi?C||c||(c=w):!u&&S&&L===k?u=w:C?p=w:c||(c=w)}}}y.filter(".picker-expired").remove(),!i&&g<t.length&&(r=l.accurateSearchHint||o.lang.accurateSearchHint),o.activeOption(u||p||c)}else n.empty(),i||(r=a?(l.emptySearchResultHint||o.lang.emptySearchResultHint).format(s):l.emptyResultHint||o.lang.emptyResultHint,a&&o.triggerEvent("noResults",{search:s,picker:o},"","chosen:no_results"));i||o.updateMessage(r,"info"),o.$dropMenu.toggleClass("picker-no-options",!t.length),o.layoutDropList(o.listRendered),o.listRendered=!0}},s.prototype.activeOption=function(t,i){var o=this;t&&(t instanceof e?t=t.attr("data-value"):"object"==typeof t&&(t=t[o.options.valueKey]));var n=o.getListItem(t);n?o.activeValue=t:t=o.activeValue;var r=o.$activeOption;if(r&&r.removeClass("picker-option-active"),r=o.$optionsList.find('[data-value="'+t+'"]'),r.length){if(r.addClass("picker-option-active"),!i){var l=r[0];l.scrollIntoViewIfNeeded?l.scrollIntoViewIfNeeded():l.scrollIntoView&&l.scrollIntoView()}o.$activeOption=r}else o.$activeOption=null},s.prototype.updateList=function(e,t,i){var o=this;void 0!==e?o.search=e:e=o.search;var n=o.options.remoteOnly;if(!n){var r=[];if(null===e||void 0===e||"string"==typeof e&&!e.length)r=o.list||[];else if("function"==typeof o.options.list)r=o.options.list({search:e,limit:o.options.maxListCount});else if(o.list&&o.list.length){var l=o.options.maxListCount,s=o.options.keysKey,a=o.options.textKey,p=o.options.valueKey,c=o.options.searchValueKey,u={};e=e.toLowerCase();for(var d=0;d<o.list.length;++d){var h=o.list[d],v=h[p];if(!o.multi||!o.isSelectedValue(v)){var f=0,g=h[a];if(null!==g&&void 0!==g&&""!==g){g=g.toLowerCase();var m=g.indexOf(e);m>-1&&(f+=0===m?20:10)}if(!f){var y=h[s];if(null!==y&&void 0!==y&&""!==y){y=y.toLowerCase();var m=y.indexOf(e);m>-1&&(f+=0===m?8:4)}}if(!f&&c&&null!==v&&void 0!==v&&""!==v){v=v.toLowerCase();var m=v.indexOf(e);m>-1&&(f+=0===m?3:1)}if(f&&(u[v]=f+(o.list.length-d)/o.list.length,r.push(h)),l&&r.length>=l)break}}r.length&&(r=r.sort(function(e,t){return u[t[p]]-u[e[p]]}))}o.renderOptionsList(r,!1,i)}t||o.getRemoteList(function(t){n?o.renderOptionsList(o.list,!1,i):o.updateList(e,!0)},n?function(){o.renderOptionsList([],!0,i)}:null)},s.prototype.showDropList=function(){var t=this;if(t.triggerEvent("showingDrop",{picker:t})!==!1){if(t.dropListShowed=!0,t.dropDirection=null,t.listRendered=!1,t.activeValue=null,n[t.id]=t,t.options.disableScrollOnShow&&e.zui.fixBodyScrollbar(),!t.$dropMenu){var i=e('<div class="picker-drop-menu" id="pickerDropMenu-'+t.id+'"></div>'),r=e('<div class="picker-option-list"></div>').appendTo(i);i.data(o,t).toggleClass("picker-multi",t.multi).toggleClass("picker-single",!t.multi).appendTo("body"),t.options.chosenMode&&i.addClass("chosen-up"),r.on("click",".picker-option",function(){t.select(e(this).attr("data-value"))}).on("mouseenter",".picker-option",function(){t.activeOption(e(this),!0)});var l=e('<div class="picker-message"></div>').appendTo(i);t.$dropMenu=i,t.$message=l,t.$optionsList=r}t.updateList(t.search,!1,function(){t.triggerEvent("showedDrop",{picker:t},"","chosen:showing_dropdown")}),t.$dropMenu.addClass("picker-drop-show")}},s.prototype.hideDropList=function(){var t=this;t.triggerEvent("hidingDrop",{picker:t})!==!1&&(t.dropListShowed=!1,t.$activeOption=null,t.activeValue=null,t.$search.val(""),t.search="",delete n[t.id],t.$dropMenu&&t.$dropMenu.removeClass("picker-drop-show"),t.options.disableScrollOnShow&&e.zui.resetBodyScrollbar(),t.triggerEvent("hiddenDrop",{picker:t},"","chosen:hiding_dropdown"))},s.prototype.updateFromSelect=function(t){var i=this,o=i.options,n=[];void 0===t&&(t=!0),i.$formItem.children("option").each(function(){var t=e(this),i=t.text(),r=t.val();if(i.length||r.length){var l={};l[o.valueKey]=r,l[o.textKey]=i,l[o.keysKey]=t.data(o.keysKey),n.push(l)}null!==o.allowSingleDeselect&&void 0!==o.allowSingleDeselect||r.length||(o.allowSingleDeselect=!0)}),i.setList(n,t)},s.prototype.setList=function(t,i){var o=this,n=o.options,r=i?[]:o.list||[],l=i?{}:o.listMap||{};"string"==typeof t&&(t=t.split(","));for(var s=0;s<t.length;++s){var a=t[s];if("string"==typeof a){var p={};p[n.textKey]=a,p[n.valueKey]=String(s),a=p}else if(e.isArray(a)){var p={};p[n.textKey]=a[0],p[n.valueKey]=a[1],p[n.keysKey]=a[2],a=p}var c=a[n.valueKey],u=l[c];u?(a.index=u.$_index,r[u.$_index]=a,l[c]=a):(a.$_index=r.length,l[c]=a,r.push(a))}this.list=r,this.listMap=l},s.prototype.getItemID=function(e,t){var i=this.id+"-item-"+e[this.options.valueKey];return void 0!==t?i+"-"+t:i},s.prototype.isSelectedValue=function(t){var i=this;if(void 0===i.value||null===i.value)return!1;if("string"!=typeof t&&(t=String(t)),i.multi){if(!i.valueSet)if(void 0!==typeof Set)i.valueSet=new Set(i.value);else{i.valueSet={};for(var o=0;o<i.value.length;++o)i.valueSet[i.value[o]]=!0}return e.isPlainObject(i.valueSet)?!!i.valueSet[t]:i.valueSet.has(t)}return t===i.value},s.prototype.getListItem=function(e){return this.listMap[e]},s.prototype.triggerEvent=function(t,i,o,n){var r=this;if(e.isArray(i)||(i=[i]),r.$.trigger(t,i),r.options.chosenMode&&n&&r.$.trigger(n,i),o=o===!0?t:o||"on"+t[0].toUpperCase()+t.substr(1),e.isFunction(r.options[o]))return r.options[o].apply(r,i)},s.prototype.setValue=function(t,i){var o=this,n=o.options;if(void 0===t&&(t=o.$formItem.val()),o.multi&&"string"==typeof t?t=t.split(n.multiValueSplitter):o.multi||"string"==typeof t||(t=String(t)),o.value!==t){if(!i&&o.triggerEvent("beforeChange",{value:t,oldValue:o.value},!0)===!1)return;o.value=t,n.onChange&&n.onChange(t),i||o.triggerEvent("change",{picker:o})}o.multi&&(o.valueSet=null);var r=o.$formItem;if("select"===o.formType){var l=n.chosenMode;l||r.empty(),o.multi?e.each(t,function(e,t){l&&r.find('option[value="'+t+'"]').length||r.append('<option value="'+t+'">')}):l&&r.find('option[value="'+t+'"]').length||r.append('<option value="'+t+'">')}r.val(t);var s=!1;if(o.multi){var a=o.$selections,p=a.children(".picker-selection").addClass("picker-expired");e.each(t,function(t,i){void 0===i||null===i?i="":"string"!=typeof i&&(i=String(i));var r=o.getListItem(i);if(r){s=!0;var l=r[n.textKey],a=o.getItemID(r,"selection"),c=p.find("#"+a);c.length?c.removeClass("picker-expired"):c=e('<div class="picker-selection" id="'+a+'"><span class="picker-selection-text"></span><span class="picker-selection-remove"></span></div>').data("value",i),c.find(".picker-selection-text").text(l),c.attr("title",l).insertBefore(o.$search)}}),p.filter(".picker-expired").remove()}else{var c=o.getListItem(t);s=!!c,o.$singleSelection.find(".picker-selection-text").text(s?c[n.textKey]:"")}o.$container.toggleClass("picker-no-value",!s).toggleClass("picker-has-value",s),o.dropListShowed&&o.renderOptionsList()},s.prototype.handleWindowScroll=function(){var e=this;e.options.disableScrollOnShow||(e.options.hideOnWindowScroll?(e.scrollEventTimer&&clearTimeout(e.scrollEventTimer),e.$dropMenu.css("opacity",0),e.scrollEventTimer=setTimeout(function(){e.scrollEventTimer=null,e.dropListShowed&&e.layoutDropList(!0,!0)},500)):e.layoutDropList(!0,!0))},s.DEFAULTS=r,s.NAME=o,s.SHOWS=n,s.convertChosenOptions=function(t){var i=!1;return e.each({allow_single_deselect:"allowSingleDeselect",inherit_select_classes:"inheritFormItemClasses",max_selected_options:"maxSelectedCount",no_results_text:"emptySearchResultHint",placeholder_text:"placeholder",placeholder_text_multiple:"placeholder",placeholder_text_single:"placeholder",single_backstroke_delete:"deleteByBackspace",display_selected_options:"showMultiSelectedOptions",drop_direction:"dropDirection",drop_width:"dropWidth",max_drop_width:"maxAutoDropWidth",highlight_selected:"autoSelectFirst",sort_value_splitter:"multiValueSplitter"},function(e,o){var n=t[e];void 0!==n&&(t[o]=n,delete t[e],i=!0)}),i&&(t.chosenMode=!0),t},e.fn.picker=function(t,i){return this.each(function(){var n=e(this),r=n.data(o),l="object"==typeof t&&t;r?"string"==typeof t&&r[t](i):((s.enabledChosenMode||l&&l.chosenMode)&&(l=s.convertChosenOptions(e.extend({},n.data(),l))),n.data(o,r=new s(this,l)))})},e.fn.picker.Constructor=s,e.Picker=e.zui.Picker=s,s.enableChosen=function(){s.enabledChosenMode||(e.fn.chosen=function(t,i){return this.each(function(){var n=e(this),r=n.data(o);if(!r){var l=e.extend({},n.data(),"object"==typeof t?t:null);return r=new s(this,s.convertChosenOptions(l)),void n.data(o,r)}"string"==typeof t&&r[t](i)})},e.fn._chosen=e.fn.chosen,s.enabledChosenMode=!0)},e.zui.fixBodyScrollbar&&e.zui({_scrollbarWidth:0,checkBodyScrollbar:function(){if(i.body.clientWidth>=t.innerWidth)return 0;if(!e.zui._scrollbarWidth){var o=i.createElement("div");o.className="modal-scrollbar-measure scrollbar-measure",i.body.appendChild(o),e.zui._scrollbarWidth=o.offsetWidth-o.clientWidth,i.body.removeChild(o)}return e.zui._scrollbarWidth},fixBodyScrollbar:function(){if(e.zui.checkBodyScrollbar()){var t=e("body"),i=parseInt(t.css("padding-right")||0,10);return e.zui._scrollbarWidth&&t.css({paddingRight:i+e.zui._scrollbarWidth,overflowY:"hidden"}),!0}},resetBodyScrollbar:function(){e("body").css({paddingRight:"",overflowY:""})}}),e(function(){e('[data-toggle="picker"]').picker(),e(i).on("mousedown",function(t){var i=e(t.target).closest(".picker,.picker-drop-menu"),o=i.length;e.each(n,function(e,t){o&&(i.is(t.$container)||t.$dropMenu&&i.is(t.$dropMenu))||t.hideDropList()})}),e(t).on("scroll",function(t){e.each(n,function(e,i){i.handleWindowScroll(t)})})})}(jQuery,window,document);